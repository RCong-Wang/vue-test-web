{"version":3,"file":"js/28.52886106.js","mappings":"0MAUIA,EAAAA,EAAAA,GAAyC,SAAlCC,IAAI,oBAAmB,OAAG,G,8DATnCD,EAAAA,EAAAA,GAEM,aADJA,EAAAA,EAAAA,GAA8B,UAA1B,QAAIE,EAAAA,EAAAA,IAAA,KAAQC,QAAM,MAExBH,EAAAA,EAAAA,GAIM,aAHJA,EAAAA,EAAAA,GAEK,0BADHI,EAAAA,EAAAA,IAAkDC,EAAAA,GAAA,MAAAC,EAAAA,EAAAA,IAA5BC,EAAAC,UAAXC,K,WAAXL,EAAAA,EAAAA,IAAkD,WAAAF,EAAAA,EAAAA,IAAfO,GAAO,M,WAG9CT,EAAAA,EAAAA,GAIM,YAHJU,GAAyC,SACzCV,EAAAA,EAAAA,GAA+D,SAAxDW,KAAK,OAAOC,GAAG,mB,qCAA4BL,EAAAM,YAAWC,I,iBAAXP,EAAAM,gBAClDb,EAAAA,EAAAA,GAA0C,UAAjCe,QAAKC,EAAA,KAAAA,EAAA,OAAAC,IAAEC,EAAAC,aAAAD,EAAAC,eAAAF,KAAa,WAAI,G,YAOrC,GACEG,KAAM,WACNC,SAAS,CACPlB,MAAAA,GACE,OAAOmB,KAAKC,OAAOC,QAAQC,SAC7B,GAEFC,IAAAA,GACE,MAAM,CACJC,UAAW,KACXnB,SAAU,GACVK,YAAY,GAEhB,EACAe,aAAAA,GACEC,OAAOC,oBAAoB,eAAgBR,KAAKS,eAClD,EACAC,OAAAA,GACEV,KAAKW,OAAQC,EAAAA,EAAAA,IAAO,SACpBZ,KAAKa,aACLb,KAAKK,UAAY,IAAIS,UAAW,4EAA2Ed,KAAKnB,WAChHmB,KAAKK,UAAUU,OAAUC,IACvBC,QAAQC,IAAI,oBAAoBF,EAAM,EAExChB,KAAKK,UAAUc,UAAaH,IAC1B,MAAM7B,EAAUiC,KAAKC,MAAML,EAAMZ,MAAMjB,QACvCa,KAAKd,SAASoC,KAAKnC,EAAQ,EAE7BoB,OAAOgB,iBAAiB,eAAgBvB,KAAKS,eAC/C,EACAe,QAAQ,CACNX,UAAAA,GACEb,KAAKW,MAAMc,IAAI,sFAAsF,CACnGC,OAAO,CACLpC,GAAKU,KAAKnB,UAEb8C,MAAKC,IACDA,EAASxB,KAAKyB,KACfZ,QAAQC,IAAIU,EAASxB,MAGrBJ,KAAKd,SAAW0C,EAASxB,IAE3B,IAED0B,OAAMC,IACLd,QAAQc,MAAM,SAASA,EAAM,GAEjC,EACAlC,WAAAA,GACuB,IAAlBG,KAAKT,YACN0B,QAAQC,IAAI,eAGZlB,KAAKW,MAAMc,IAAI,oFACdE,MAAKC,IACJ,MAAMI,EAAOJ,EAASxB,KAAK6B,WACrB7B,EAAO,CACXlB,SAAUc,KAAKT,YACfD,GAAIU,KAAKnB,QAEXmB,KAAKW,MAAMuB,KAAK,uFAAwF9B,EAAM,CAC5G+B,iBAAiB,EACjBC,QAAS,CACP,cAAeJ,EACf,eAAgB,sBAGnBL,MAAKC,IACJX,QAAQC,IAAI,OAAOU,EAASxB,MAC5B,MAAMA,EAAO,CACXjB,QAASyC,EAASxB,KAAKd,IAEzBU,KAAKK,UAAUgC,KAAKjB,KAAKkB,UAAUlC,IACnCJ,KAAKT,YAAc,EAAE,IAEtBuC,OAAMC,IACLd,QAAQc,MAAM,OAAOA,EAAM,GAC3B,GAGR,EACAtB,cAAAA,GACET,KAAKK,UAAUkC,OACjB,I,QClGJ,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,KAEpE,O","sources":["webpack://my-vue-app/./src/views/Chatroom.vue","webpack://my-vue-app/./src/views/Chatroom.vue?f235"],"sourcesContent":["<template>\r\n  <div>\r\n    <h1>聊天室:{{ this.roomID }}</h1>\r\n  </div>\r\n  <div>\r\n    <ul>\r\n      <li v-for=\"message in messages\">{{ message }}</li>\r\n    </ul>\r\n  </div>\r\n  <div>\r\n    <label for=\"send-message-box\">訊息框</label>\r\n    <input type=\"text\" id=\"send-message-box\" v-model=\"sendmessage\">\r\n    <button @click=\"SendMessage\">發送訊息</button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { inject } from 'vue';\r\n\r\nexport default{\r\n  name: \"Chatroom\",\r\n  computed:{\r\n    roomID() {\r\n      return this.$store.getters.getroomid;\r\n    },\r\n  },\r\n  data(){\r\n    return{\r\n      websocket: null,\r\n      messages: [],\r\n      sendmessage:'',\r\n    }\r\n  },\r\n  beforeUnmount() {\r\n    window.removeEventListener(\"beforeunload\", this.closeWebSocket);\r\n  },\r\n  created(){\r\n    this.axios = inject('axios');\r\n    this.GetMessage();\r\n    this.websocket = new WebSocket(`wss://5e0d-2401-e180-8d23-1fdd-b1d6-64a-7746-e486.ngrok-free.app/ws/chat/${this.roomID}/`);\r\n    this.websocket.onopen = (event) =>{\r\n      console.log(\"successful link: \",event);\r\n    };\r\n    this.websocket.onmessage = (event) =>{\r\n      const message = JSON.parse(event.data).message;\r\n      this.messages.push(message);\r\n    };\r\n    window.addEventListener(\"beforeunload\", this.closeWebSocket);\r\n  },\r\n  methods:{\r\n    GetMessage(){\r\n      this.axios.get(\"https://5e0d-2401-e180-8d23-1fdd-b1d6-64a-7746-e486.ngrok-free.app/main/getmessage/\",{\r\n        params:{\r\n          id : this.roomID,\r\n        }})\r\n      .then(response=>{\r\n        if(response.data.fail){\r\n          console.log(response.data)\r\n        }\r\n        else{\r\n          this.messages = response.data;\r\n\r\n        }\r\n      })\r\n      .catch(error=>{\r\n        console.error('獲得訊息失敗',error);\r\n      })\r\n    },\r\n    SendMessage(){\r\n      if(this.sendmessage==''){\r\n        console.log('發送失敗: 訊息欄為空');\r\n      }\r\n      else{\r\n        this.axios.get('https://5e0d-2401-e180-8d23-1fdd-b1d6-64a-7746-e486.ngrok-free.app/user/getcsrf/')\r\n        .then(response=>{\r\n          const csrf = response.data.csrf_token;\r\n          const data = {\r\n            messages: this.sendmessage,\r\n            id: this.roomID\r\n          };\r\n          this.axios.post('https://5e0d-2401-e180-8d23-1fdd-b1d6-64a-7746-e486.ngrok-free.app/main/sendmessage/', data, {\r\n            withCredentials: true,\r\n            headers: {\r\n              'X-CSRFToken': csrf,\r\n              'Content-Type': 'application/json',\r\n            }\r\n          })\r\n          .then(response=>{\r\n            console.log(\"發送成功\",response.data);\r\n            const data = {\r\n              message: response.data.id,\r\n            };\r\n            this.websocket.send(JSON.stringify(data));\r\n            this.sendmessage = '';\r\n          })\r\n          .catch(error=>{\r\n            console.error('發送失敗',error);\r\n          })\r\n        })\r\n      }\r\n    },\r\n    closeWebSocket() {\r\n      this.websocket.close();\r\n    },\r\n  }\r\n}\r\n\r\n\r\n</script>","import { render } from \"./Chatroom.vue?vue&type=template&id=f84249b4\"\nimport script from \"./Chatroom.vue?vue&type=script&lang=js\"\nexport * from \"./Chatroom.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","for","_toDisplayString","roomID","_createElementBlock","_Fragment","_renderList","$data","messages","message","_hoisted_1","type","id","sendmessage","$event","onClick","_cache","args","$options","SendMessage","name","computed","this","$store","getters","getroomid","data","websocket","beforeUnmount","window","removeEventListener","closeWebSocket","created","axios","inject","GetMessage","WebSocket","onopen","event","console","log","onmessage","JSON","parse","push","addEventListener","methods","get","params","then","response","fail","catch","error","csrf","csrf_token","post","withCredentials","headers","send","stringify","close","__exports__","render"],"sourceRoot":""}