"use strict";(self["webpackChunkmy_vue_app"]=self["webpackChunkmy_vue_app"]||[]).push([[393],{7393:function(e,s,t){t.r(s),t.d(s,{default:function(){return f}});var a=t(3396),n=t(7139),o=t(9242);const i={class:"chat-window"},r={class:"message-container",ref:"messageContainer"},c={style:{"font-size":"12px"}},l=(0,a._)("br",null,null,-1),d={style:{"border-style":"dashed"}},g={class:"input-container"};function h(e,s,t,h,u,m){return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",null,[(0,a._)("h1",null,"聊天室:"+(0,n.zw)(this.roomID),1)]),(0,a._)("div",i,[(0,a._)("div",r,[(0,a._)("ul",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(u.messages,(e=>((0,a.wg)(),(0,a.iD)("li",null,[(0,a._)("p",null,[(0,a._)("span",c,(0,n.zw)(e.time),1),l,(0,a._)("span",d,(0,n.zw)(e.senter)+": "+(0,n.zw)(e.context),1)])])))),256))])],512)]),(0,a._)("div",g,[(0,a.wy)((0,a._)("input",{type:"text",id:"send-message-box","onUpdate:modelValue":s[0]||(s[0]=e=>u.sendmessage=e),onKeyup:s[1]||(s[1]=(0,o.D2)(((...e)=>m.SendMessage&&m.SendMessage(...e)),["enter"]))},null,544),[[o.nr,u.sendmessage]]),(0,a._)("button",{onClick:s[2]||(s[2]=(...e)=>m.SendMessage&&m.SendMessage(...e))},"發送訊息")])],64)}var u={name:"Chatroom",computed:{roomID(){return this.$store.getters.getroomid}},data(){return{websocket:null,messages:[],sendmessage:""}},beforeUnmount(){window.removeEventListener("beforeunload",this.closeWebSocket)},created(){this.axios=(0,a.f3)("axios"),this.GetMessage(),this.websocket=new WebSocket(`wss://aa0e-2401-e180-8850-ae-c03b-534a-dcee-f333.ngrok-free.app/ws/chat/${this.roomID}/`),this.websocket.onopen=e=>{console.log("successful link: ",e)},window.addEventListener("beforeunload",this.closeWebSocket)},mounted(){this.websocket.onmessage=e=>{const s=JSON.parse(e.data).message;this.messages.unshift(s)}},methods:{GetMessage(){this.axios.get("https://aa0e-2401-e180-8850-ae-c03b-534a-dcee-f333.ngrok-free.app/main/getmessage/",{params:{id:this.roomID}}).then((e=>{e.data.fail?console.log(e.data):this.messages=e.data})).catch((e=>{console.error("獲得訊息失敗",e)}))},SendMessage(){""==this.sendmessage?console.log("發送失敗: 訊息欄為空"):this.axios.get("https://aa0e-2401-e180-8850-ae-c03b-534a-dcee-f333.ngrok-free.app/user/getcsrf/").then((e=>{const s=e.data.csrf_token,t={messages:this.sendmessage,id:this.roomID};this.axios.post("https://aa0e-2401-e180-8850-ae-c03b-534a-dcee-f333.ngrok-free.app/main/sendmessage/",t,{withCredentials:!0,headers:{"X-CSRFToken":s,"Content-Type":"application/json"}}).then((e=>{console.log("發送成功",e.data);const s={message:e.data.id};this.websocket.send(JSON.stringify(s)),this.sendmessage=""})).catch((e=>{console.error("發送失敗",e)}))}))},closeWebSocket(){this.websocket.close()}}},m=t(89);const p=(0,m.Z)(u,[["render",h]]);var f=p}}]);
//# sourceMappingURL=393.b26708d5.js.map