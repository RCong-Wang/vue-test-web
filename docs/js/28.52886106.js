"use strict";(self["webpackChunkmy_vue_app"]=self["webpackChunkmy_vue_app"]||[]).push([[28],{3028:function(e,s,t){t.r(s),t.d(s,{default:function(){return g}});var o=t(3396),n=t(7139),a=t(9242);const d=(0,o._)("label",{for:"send-message-box"},"訊息框",-1);function i(e,s,t,i,r,l){return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",null,[(0,o._)("h1",null,"聊天室:"+(0,n.zw)(this.roomID),1)]),(0,o._)("div",null,[(0,o._)("ul",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.messages,(e=>((0,o.wg)(),(0,o.iD)("li",null,(0,n.zw)(e),1)))),256))])]),(0,o._)("div",null,[d,(0,o.wy)((0,o._)("input",{type:"text",id:"send-message-box","onUpdate:modelValue":s[0]||(s[0]=e=>r.sendmessage=e)},null,512),[[a.nr,r.sendmessage]]),(0,o._)("button",{onClick:s[1]||(s[1]=(...e)=>l.SendMessage&&l.SendMessage(...e))},"發送訊息")])],64)}t(560);var r={name:"Chatroom",computed:{roomID(){return this.$store.getters.getroomid}},data(){return{websocket:null,messages:[],sendmessage:""}},beforeUnmount(){window.removeEventListener("beforeunload",this.closeWebSocket)},created(){this.axios=(0,o.f3)("axios"),this.GetMessage(),this.websocket=new WebSocket(`wss://5e0d-2401-e180-8d23-1fdd-b1d6-64a-7746-e486.ngrok-free.app/ws/chat/${this.roomID}/`),this.websocket.onopen=e=>{console.log("successful link: ",e)},this.websocket.onmessage=e=>{const s=JSON.parse(e.data).message;this.messages.push(s)},window.addEventListener("beforeunload",this.closeWebSocket)},methods:{GetMessage(){this.axios.get("https://5e0d-2401-e180-8d23-1fdd-b1d6-64a-7746-e486.ngrok-free.app/main/getmessage/",{params:{id:this.roomID}}).then((e=>{e.data.fail?console.log(e.data):this.messages=e.data})).catch((e=>{console.error("獲得訊息失敗",e)}))},SendMessage(){""==this.sendmessage?console.log("發送失敗: 訊息欄為空"):this.axios.get("https://5e0d-2401-e180-8d23-1fdd-b1d6-64a-7746-e486.ngrok-free.app/user/getcsrf/").then((e=>{const s=e.data.csrf_token,t={messages:this.sendmessage,id:this.roomID};this.axios.post("https://5e0d-2401-e180-8d23-1fdd-b1d6-64a-7746-e486.ngrok-free.app/main/sendmessage/",t,{withCredentials:!0,headers:{"X-CSRFToken":s,"Content-Type":"application/json"}}).then((e=>{console.log("發送成功",e.data);const s={message:e.data.id};this.websocket.send(JSON.stringify(s)),this.sendmessage=""})).catch((e=>{console.error("發送失敗",e)}))}))},closeWebSocket(){this.websocket.close()}}},l=t(89);const c=(0,l.Z)(r,[["render",i]]);var g=c}}]);
//# sourceMappingURL=28.52886106.js.map