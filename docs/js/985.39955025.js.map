{"version":3,"file":"js/985.39955025.js","mappings":"2MAIOA,MAAM,e,GACJA,MAAM,oBAAoBC,IAAI,oB,GAIrBC,MAAA,sB,GAAkDC,EAAAA,EAAAA,GAAI,mB,GACtDD,MAAA,2B,GAMXF,MAAM,mB,8DAfXG,EAAAA,EAAAA,GAEM,aADJA,EAAAA,EAAAA,GAA8B,UAA1B,QAAIC,EAAAA,EAAAA,IAAA,KAAQC,QAAM,MAExBF,EAAAA,EAAAA,GAWM,MAXNG,EAWM,EAVJH,EAAAA,EAAAA,GASM,MATNI,EASM,EARJJ,EAAAA,EAAAA,GAOK,0BANHK,EAAAA,EAAAA,IAKKC,EAAAA,GAAA,MAAAC,EAAAA,EAAAA,IALiBC,EAAAC,UAAXC,K,WAAXL,EAAAA,EAAAA,IAKK,YAJHL,EAAAA,EAAAA,GAGI,WAFFA,EAAAA,EAAAA,GAAwD,OAAxDW,GAAwDV,EAAAA,EAAAA,IAAtBS,EAAQE,MAAI,GAAUC,GACxDb,EAAAA,EAAAA,GAAsF,OAAtFc,GAAsFb,EAAAA,EAAAA,IAA/CS,EAAQK,QAAS,MAAEd,EAAAA,EAAAA,IAAGS,EAAQM,SAAO,U,iBAMtFhB,EAAAA,EAAAA,GAGM,MAHNiB,EAGM,WAFJjB,EAAAA,EAAAA,GAA2F,SAApFkB,KAAK,OAAOC,GAAG,mB,qCAA4BX,EAAAY,YAAWC,GAAGC,QAAKC,EAAA,KAAAA,EAAA,IAAAC,EAAAA,EAAAA,KAAA,IAAAC,IAAQC,EAAAC,aAAAD,EAAAC,eAAAF,IAAW,a,iBAAtCjB,EAAAY,gBAClDpB,EAAAA,EAAAA,GAA0C,UAAjC4B,QAAKL,EAAA,KAAAA,EAAA,OAAAE,IAAEC,EAAAC,aAAAD,EAAAC,eAAAF,KAAa,WAAI,G,CAOrC,OACEI,KAAM,WACNC,SAAS,CACP5B,MAAAA,GACE,OAAO6B,KAAKC,OAAOC,QAAQC,SAC7B,GAEFC,IAAAA,GACE,MAAM,CACJC,UAAW,KACX3B,SAAU,GACVW,YAAY,GAEhB,EACAiB,aAAAA,GACEC,OAAOC,oBAAoB,eAAgBR,KAAKS,eAClD,EACAC,OAAAA,GACEV,KAAKW,OAAQC,EAAAA,EAAAA,IAAO,SACpBZ,KAAKa,aACLb,KAAKK,UAAY,IAAIS,UAAW,GAAEd,KAAKe,oBAAoBf,KAAK7B,WAChE6B,KAAKK,UAAUW,OAAUC,IACvBC,QAAQC,IAAI,oBAAoBF,EAAM,EAExCV,OAAOa,iBAAiB,eAAgBpB,KAAKS,eAC/C,EACAY,OAAAA,GACErB,KAAKK,UAAUiB,UAAaL,IAC1B,MAAMtC,EAAU4C,KAAKC,MAAMP,EAAMb,MAAMzB,QAEvCqB,KAAKtB,SAAS+C,QAAQ9C,EAAQ,CAElC,EACA+C,QAAQ,CACNb,UAAAA,GACEb,KAAKW,MAAMgB,IAAK,GAAE3B,KAAK4B,8BAA8B,CACnDC,OAAO,CACLzC,GAAKY,KAAK7B,UAEb2D,MAAKC,IACDA,EAAS3B,KAAK4B,KACfd,QAAQC,IAAIY,EAAS3B,MAGrBJ,KAAKtB,SAAWqD,EAAS3B,IAC3B,IAED6B,OAAMC,IACLhB,QAAQgB,MAAM,SAASA,EAAM,GAEjC,EACAtC,WAAAA,GACuB,IAAlBI,KAAKX,YACN6B,QAAQC,IAAI,eAGZnB,KAAKW,MAAMgB,IAAK,GAAE3B,KAAK4B,4BACtBE,MAAKC,IACJ,MAAMI,EAAOJ,EAAS3B,KAAKgC,WACrBhC,EAAO,CACX1B,SAAUsB,KAAKX,YACfD,GAAIY,KAAK7B,QAEX6B,KAAKW,MAAM0B,KAAM,GAAErC,KAAK4B,+BAAgCxB,EAAM,CAC5DkC,iBAAiB,EACjBC,QAAS,CACP,cAAeJ,EACf,eAAgB,sBAGnBL,MAAKC,IACJb,QAAQC,IAAI,OAAOY,EAAS3B,MAC5B,MAAMA,EAAO,CACXzB,QAASoD,EAAS3B,KAAKhB,IAEzBY,KAAKK,UAAUmC,KAAKjB,KAAKkB,UAAUrC,IACnCJ,KAAKX,YAAc,EAAE,IAEtB4C,OAAMC,IACLhB,QAAQgB,MAAM,OAAOA,EAAM,GAC3B,GAGR,EACAzB,cAAAA,GACET,KAAKK,UAAUqC,OACjB,I,QCxGJ,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,KAEpE,O","sources":["webpack://my-vue-app/./src/views/Chatroom.vue","webpack://my-vue-app/./src/views/Chatroom.vue?f235"],"sourcesContent":["<template>\r\n  <div>\r\n    <h1>聊天室:{{ this.roomID }}</h1>\r\n  </div>\r\n  <div class=\"chat-window\">\r\n    <div class=\"message-container\" ref=\"messageContainer\">\r\n      <ul>\r\n        <li v-for=\"message in messages\">\r\n          <p>\r\n            <span style=\"font-size: 12px;\">{{ message.time }}</span><br>\r\n            <span style=\"border-style: dashed;\">{{ message.senter }}: {{ message.context }}</span>\r\n          </p>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n  <div class=\"input-container\">\r\n    <input type=\"text\" id=\"send-message-box\" v-model=\"sendmessage\" @keyup.enter=\"SendMessage\"/>\r\n    <button @click=\"SendMessage\">發送訊息</button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { inject } from 'vue';\r\n\r\nexport default{\r\n  name: \"Chatroom\",\r\n  computed:{\r\n    roomID() {\r\n      return this.$store.getters.getroomid;\r\n    },\r\n  },\r\n  data(){\r\n    return{\r\n      websocket: null,\r\n      messages: [],\r\n      sendmessage:'',\r\n    }\r\n  },\r\n  beforeUnmount() {\r\n    window.removeEventListener(\"beforeunload\", this.closeWebSocket);\r\n  },\r\n  created(){\r\n    this.axios = inject('axios');\r\n    this.GetMessage();\r\n    this.websocket = new WebSocket(`${this.local_ws}/ws/chat/${this.roomID}/`);\r\n    this.websocket.onopen = (event) =>{\r\n      console.log(\"successful link: \",event);\r\n    };\r\n    window.addEventListener(\"beforeunload\", this.closeWebSocket);\r\n  },\r\n  mounted() {\r\n    this.websocket.onmessage = (event) =>{\r\n      const message = JSON.parse(event.data).message;\r\n      // this.messages.push(message);\r\n      this.messages.unshift(message);\r\n    };\r\n  },\r\n  methods:{\r\n    GetMessage(){\r\n      this.axios.get(`${this.local_http}/main/getmessage/`,{\r\n        params:{\r\n          id : this.roomID,\r\n        }})\r\n      .then(response=>{\r\n        if(response.data.fail){\r\n          console.log(response.data)\r\n        }\r\n        else{\r\n          this.messages = response.data;\r\n        }\r\n      })\r\n      .catch(error=>{\r\n        console.error('獲得訊息失敗',error);\r\n      })\r\n    },\r\n    SendMessage(){\r\n      if(this.sendmessage==''){\r\n        console.log('發送失敗: 訊息欄為空');\r\n      }\r\n      else{\r\n        this.axios.get(`${this.local_http}/user/getcsrf/`)\r\n        .then(response=>{\r\n          const csrf = response.data.csrf_token;\r\n          const data = {\r\n            messages: this.sendmessage,\r\n            id: this.roomID\r\n          };\r\n          this.axios.post(`${this.local_http}/main/sendmessage/`, data, {\r\n            withCredentials: true,\r\n            headers: {\r\n              'X-CSRFToken': csrf,\r\n              'Content-Type': 'application/json',\r\n            }\r\n          })\r\n          .then(response=>{\r\n            console.log(\"發送成功\",response.data);\r\n            const data = {\r\n              message: response.data.id,\r\n            };\r\n            this.websocket.send(JSON.stringify(data));\r\n            this.sendmessage = '';\r\n          })\r\n          .catch(error=>{\r\n            console.error('發送失敗',error);\r\n          })\r\n        })\r\n      }\r\n    },\r\n    closeWebSocket() {\r\n      this.websocket.close();\r\n    },\r\n  }\r\n}\r\n\r\n\r\n</script>\r\n<style>\r\n.chat-window {\r\n  width: auto;\r\n  border: 1px solid #ccc;\r\n  overflow: hidden;\r\n}\r\n\r\n.message-container {\r\n  height: 200px;\r\n  overflow-y: auto;\r\n}\r\n\r\n#send-message-box {\r\n  width:100%;\r\n  height: 30px;\r\n}\r\n.input-container {\r\n  padding: 8px;\r\n  /* border-top: 1px solid #ccc; */\r\n}\r\n</style>","import { render } from \"./Chatroom.vue?vue&type=template&id=9e36e92c\"\nimport script from \"./Chatroom.vue?vue&type=script&lang=js\"\nexport * from \"./Chatroom.vue?vue&type=script&lang=js\"\n\nimport \"./Chatroom.vue?vue&type=style&index=0&id=9e36e92c&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","ref","style","_createElementVNode","_toDisplayString","roomID","_hoisted_1","_hoisted_2","_createElementBlock","_Fragment","_renderList","$data","messages","message","_hoisted_3","time","_hoisted_4","_hoisted_5","senter","context","_hoisted_6","type","id","sendmessage","$event","onKeyup","_cache","_withKeys","args","$options","SendMessage","onClick","name","computed","this","$store","getters","getroomid","data","websocket","beforeUnmount","window","removeEventListener","closeWebSocket","created","axios","inject","GetMessage","WebSocket","local_ws","onopen","event","console","log","addEventListener","mounted","onmessage","JSON","parse","unshift","methods","get","local_http","params","then","response","fail","catch","error","csrf","csrf_token","post","withCredentials","headers","send","stringify","close","__exports__","render"],"sourceRoot":""}