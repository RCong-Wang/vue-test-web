{"version":3,"file":"js/205.3b6cac34.js","mappings":"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","sources":["webpack://my-vue-app/./src/views/Chatroom.vue","webpack://my-vue-app/./src/components/MessageContextMenu.vue","webpack://my-vue-app/./src/components/MessageContextMenu.vue?7bf1","webpack://my-vue-app/./src/views/Chatroom.vue?f235"],"sourcesContent":["<template>\r\n  <div>\r\n    <h1>聊天室:{{ this.roomID }}</h1>\r\n  </div>\r\n  <div class=\"chat-window\">\r\n    <div class=\"message-container\" ref=\"messageContainer\">\r\n      <ul>\r\n        <li v-for=\"(message, index) in messages\" :key=\"message.id\">\r\n          <p>\r\n            <span style=\"font-size: 12px;\">{{ message.time }}</span><br>\r\n            {{ message.senter }}: <span style=\"border-style: dashed;\" @contextmenu.prevent=\"showMessageContextMenu(message, $event)\">\r\n                {{ message.context }}\r\n                <Teleport to=\"body\">\r\n                  <MessageContextMenu \r\n                    v-if=\"isMessageContextMenu\" :position=\"contextMenuPosion\" :message=\"currentMessage\"\r\n                    @close=\"closeMessageContextMenu\"\r\n                  />\r\n                </Teleport>\r\n            </span>\r\n          </p>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n  <div class=\"input-container\">\r\n    <input type=\"text\" id=\"send-message-box\" v-model=\"sendmessage\" @keyup.enter=\"SendMessage\"/>\r\n    <button @click=\"SendMessage\">發送訊息</button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { inject } from 'vue';\r\nimport { ref } from 'vue';\r\n\r\nimport MessageContextMenu from '@/components/MessageContextMenu.vue';\r\n\r\nexport default{\r\n  name: \"Chatroom\",\r\n  components:{\r\n    MessageContextMenu,\r\n  },\r\n  setup(){\r\n    const isMessageContextMenu = ref(false);\r\n    const contextMenuPosion = ref({top:0,left:0});\r\n    const currentMessage = ref(null);\r\n    const showMessageContextMenu = (message, event)=>{\r\n      event.preventDefault();\r\n      isMessageContextMenu.value = true;\r\n      contextMenuPosion.value = {top:event.clientY,left:event.clientX};\r\n      currentMessage.value = message;\r\n    };\r\n    const closeMessageContextMenu = () =>{\r\n      isMessageContextMenu.value = false;\r\n    };\r\n    return {\r\n      isMessageContextMenu,\r\n      contextMenuPosion,\r\n      currentMessage,\r\n      showMessageContextMenu,\r\n      closeMessageContextMenu,\r\n    }\r\n  },\r\n  computed:{\r\n    roomID() {\r\n      return this.$store.getters.getroomid;\r\n    },\r\n  },\r\n  data(){\r\n    return{\r\n      websocket: null,\r\n      messages: [],\r\n      sendmessage:'',\r\n    }\r\n  },\r\n  beforeUnmount() {\r\n    window.removeEventListener(\"beforeunload\", this.closeWebSocket);\r\n  },\r\n  created(){\r\n    this.axios = inject('axios');\r\n    this.GetMessage();\r\n    this.websocket = new WebSocket(`ws://127.0.0.1:8000/ws/chat/${this.roomID}/`);\r\n    this.websocket.onopen = (event) =>{\r\n      console.log(\"successful link: \",event);\r\n    };\r\n    window.addEventListener(\"beforeunload\", this.closeWebSocket);\r\n  },\r\n  mounted() {\r\n    this.websocket.onmessage = (event) =>{\r\n      const message = JSON.parse(event.data).message;\r\n      // this.messages.push(message);\r\n      this.messages.unshift(message);\r\n    };\r\n  },\r\n  methods:{\r\n    GetMessage(){\r\n      this.axios.get(`http://127.0.0.1:8000/main/api/messages/`,{\r\n        params:{\r\n          id : this.roomID,\r\n        }})\r\n      .then(response=>{\r\n        if(response.data.fail){\r\n          console.log(response.data)\r\n        }\r\n        else{\r\n          this.messages = response.data;\r\n        }\r\n      })\r\n      .catch(error=>{\r\n        console.error('獲得訊息失敗',error);\r\n      })\r\n    },\r\n    SendMessage(){\r\n      if(this.sendmessage==''){\r\n        console.log('發送失敗: 訊息欄為空');\r\n      }\r\n      else{\r\n        this.axios.get(`http://127.0.0.1:8000/user/getcsrf/`)\r\n        .then(response=>{\r\n          const csrf = response.data.csrf_token;\r\n          const data = {\r\n            context: this.sendmessage,\r\n            room: [this.roomID],\r\n          };\r\n          this.axios.post(`http://127.0.0.1:8000/main/api/messages/`, data, {\r\n            withCredentials: true,\r\n            headers: {\r\n              'X-CSRFToken': csrf,\r\n              'Content-Type': 'application/json',\r\n            }\r\n          })\r\n          .then(response=>{\r\n            console.log(\"發送成功\",response.data);\r\n            const data = {\r\n              message: response.data.id,\r\n            };\r\n            this.websocket.send(JSON.stringify(data));\r\n            this.sendmessage = '';\r\n          })\r\n          .catch(error=>{\r\n            console.error('發送失敗',error);\r\n          })\r\n        })\r\n      }\r\n    },\r\n    closeWebSocket() {\r\n      this.websocket.close();\r\n    },\r\n  }\r\n}\r\n\r\n\r\n</script>\r\n<style>\r\n.chat-window {\r\n  width: auto;\r\n  border: 1px solid #ccc;\r\n  overflow: hidden;\r\n}\r\n\r\n.message-container {\r\n  height: 200px;\r\n  overflow-y: auto;\r\n}\r\n\r\n#send-message-box {\r\n  width:100%;\r\n  height: 30px;\r\n}\r\n.input-container {\r\n  padding: 8px;\r\n  /* border-top: 1px solid #ccc; */\r\n}\r\n</style>","<template>\r\n    <div class=\"context-menu\" :style=\"{ top: `${position.top}px`, left: `${position.left}px` }\">\r\n      <ul>\r\n        <li ref=\"editableMessage\" contenteditable @keydown.enter>Edit</li>\r\n        <li @click=\"handleAction('delete')\">Delete</li>\r\n        <li @click=\"handleAction('close')\">Close</li>\r\n      </ul>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { inject } from 'vue';\r\n\r\n  export default {\r\n    props: {\r\n      position: Object,\r\n      message: Object,\r\n    },\r\n    created(){\r\n      this.axios = inject('axios');\r\n    },\r\n    methods: {\r\n      handleAction(action) {\r\n        // 處理右鍵後的選單\r\n        this.$emit('close'); // 關閉選單\r\n        // 執行選單內容\r\n        if (action === 'edit') {\r\n          console.log(this.message);\r\n        } else if (action === 'delete') {\r\n          console.log(this.message);\r\n          this.DeleteMessage();\r\n        }\r\n        else if(action==='close') {\r\n          console.log('Close...');\r\n        }\r\n      },\r\n      DeleteMessage(){\r\n        this.axios.get(`http://127.0.0.1:8000/user/getcsrf/`)\r\n        .then(response=>{\r\n          const csrf = response.data.csrf_token;\r\n          this.axios.delete(`http://127.0.0.1:8000/main/api/messages/${this.message.id}/`,{\r\n            headers: {\r\n              'X-CSRFToken': csrf,\r\n              'Content-Type': 'application/json',\r\n            },\r\n            withCredentials: true,\r\n          })\r\n          .then(response=>{\r\n            console.log(response.data);\r\n          })\r\n          .catch(error=>{\r\n            console.error(\"訊息刪除失敗: \",error);\r\n          })\r\n        })\r\n      },\r\n      EditMessage(){\r\n\r\n      },\r\n    },\r\n  };\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .context-menu {\r\n    position: fixed;\r\n    background-color: white;\r\n    border: 1px solid #ccc;\r\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\r\n    z-index: 1000;\r\n  }\r\n  \r\n  .context-menu ul {\r\n    list-style: none;\r\n    padding: 0;\r\n    margin: 0;\r\n  }\r\n  \r\n  .context-menu li {\r\n    padding: 8px 16px;\r\n    cursor: pointer;\r\n  }\r\n  \r\n  .context-menu li:hover {\r\n    background-color: #f0f0f0;\r\n  }\r\n  </style>\r\n  ","import { render } from \"./MessageContextMenu.vue?vue&type=template&id=57c5dd0a&scoped=true\"\nimport script from \"./MessageContextMenu.vue?vue&type=script&lang=js\"\nexport * from \"./MessageContextMenu.vue?vue&type=script&lang=js\"\n\nimport \"./MessageContextMenu.vue?vue&type=style&index=0&id=57c5dd0a&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-57c5dd0a\"]])\n\nexport default __exports__","import { render } from \"./Chatroom.vue?vue&type=template&id=19fedbea\"\nimport script from \"./Chatroom.vue?vue&type=script&lang=js\"\nexport * from \"./Chatroom.vue?vue&type=script&lang=js\"\n\nimport \"./Chatroom.vue?vue&type=style&index=0&id=19fedbea&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","ref","style","_createElementVNode","_toDisplayString","roomID","_hoisted_1","_hoisted_2","_createElementBlock","_Fragment","_renderList","$data","messages","message","index","key","id","_hoisted_3","time","_hoisted_4","senter","onContextmenu","_withModifiers","$event","$setup","showMessageContextMenu","context","_createBlock","_Teleport","to","isMessageContextMenu","_component_MessageContextMenu","position","contextMenuPosion","currentMessage","onClose","closeMessageContextMenu","_hoisted_6","type","sendmessage","onKeyup","_cache","_withKeys","args","$options","SendMessage","onClick","_normalizeStyle","top","$props","left","contenteditable","onKeydown","handleAction","props","Object","created","this","axios","inject","methods","action","$emit","console","log","DeleteMessage","get","then","response","csrf","data","csrf_token","delete","headers","withCredentials","catch","error","EditMessage","__exports__","name","components","MessageContextMenu","setup","event","preventDefault","value","clientY","clientX","computed","$store","getters","getroomid","websocket","beforeUnmount","window","removeEventListener","closeWebSocket","GetMessage","WebSocket","onopen","addEventListener","mounted","onmessage","JSON","parse","unshift","params","fail","room","post","send","stringify","close","render"],"sourceRoot":""}